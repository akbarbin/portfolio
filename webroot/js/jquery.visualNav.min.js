/*
 * Visual Navigation (visualNav) v2.2 minified
 * https://github.com/Mottie/visualNav/wiki
 *
 * Copyright (c) 2011 Rob Garrison (aka Mottie & Fudgey)
 * Dual licensed under the MIT and GPL licenses.
 *
 */

(function(a){a.visualNav=function(b,c){var d=this;d.$el=a(b);d.$el.data("visualNav",d);d.win=window;d.$win=a(d.win);d.$doc=a(document);var e="html, body";a("html, body").each(function(){var b=a(this).attr("scrollTop");a(this).attr("scrollTop",b+1);if(a(this).attr("scrollTop")===b+1){e=this.nodeName.toLowerCase();a(this).attr("scrollTop",b);return false}});d.$body=a(e);d.init=function(){d.options=a.extend({},a.visualNav.defaultOptions,c);d.content=a("."+d.options.contentClass);d.leftMargin=parseInt(d.content.css("margin-left"),10);d.rightMargin=parseInt(d.content.css("margin-right"),10);if(!a.isFunction(a.easing[d.options.easing[0]])){d.options.easing=["swing","swing"]}d.$body.bind("scroll mousedown DOMMouseScroll mousewheel keyup",function(a){if(a.which>0||a.type==="mousedown"||a.type==="mousewheel"){d.$body.stop()}});var b=d.options.selectedAppliedTo+(d.options.selectedAppliedTo===d.options.link?"":" "+d.options.link);d.$el.find(b).add(a("."+d.options.contentLinks)).click(function(){var b=this.tagName==="A"?"href":d.options.targetAttr;d.animate(a(this).attr(b));return false});d.$win.scroll(function(){d.findLocation()}).resize(function(){d.findLocation()})};d.animate=function(b){if(b!=="#"&&a(b).length){var c=a(b).eq(0).closest("."+d.options.contentClass);d.$body.stop().animate({scrollLeft:Math.min(c.offset().left,d.$doc.width()-d.$win.width())-d.leftMargin,scrollTop:Math.min(c.offset().top,d.$doc.height()-d.$win.height())},{queue:false,duration:d.options.animationTime,specialEasing:{scrollLeft:d.options.easing[0]||"swing",scrollTop:d.options.easing[1]||d.options.easing[0]||"swing"},complete:function(){if(d.options.useHash){d.win.location.hash=c[0].id}}})}};d.findLocation=function(){var b,c,e,f,g,h,i,j,k=d.$win.width(),l=d.$win.scrollLeft(),m=d.$win.scrollTop(),n=l+k,o=m+d.$win.height(),p=d.$doc.height(),q=d.$el.find(d.options.selectedAppliedTo).removeClass(d.options.inViewClass);if(d.options.fitContent){d.content.width(k-d.leftMargin-d.rightMargin)}d.$el.find(d.options.link).each(function(k){f=a(this).attr(d.options.targetAttr);b=f==="#"||f.length<=1?"":a(f);if(b.length){e=Math.ceil(b.offset().top);c=Math.ceil(b.offset().left);h=b.outerHeight();g=e+h+d.options.bottomMargin;i=b.outerWidth();j=c+i;if(e<o&&(e+h-d.options.bottomMargin>m||g>o)&&c<n&&(c+i-d.options.bottomMargin>l||j>n)){q.eq(k).addClass(d.options.inViewClass)}}});f=o+d.options.bottomMargin>=p?":last":":first";q.removeClass(d.options.selectedClass);q.filter("."+d.options.inViewClass+f).addClass(d.options.selectedClass)};d.init();if(d.options.useHash&&d.win.location.hash){setTimeout(function(){d.animate(d.win.location.hash)},d.options.animationTime/2)}d.findLocation()};a.visualNav.defaultOptions={link:"a",targetAttr:"href",selectedAppliedTo:"li",contentClass:"content",contentLinks:"sidemenu",useHash:false,inViewClass:"inView",selectedClass:"selected",bottomMargin:100,fitContent:false,animationTime:1200,easing:["swing","swing"]};a.fn.visualNav=function(b){return this.each(function(){var c=a(this).data("visualNav");if(typeof b==="string"&&/^(#|\.)/.test(b)){c.animate(b)}if(c){return}new a.visualNav(this,b)})};a.fn.getvisualNav=function(){return this.data("visualNav")}})(jQuery)